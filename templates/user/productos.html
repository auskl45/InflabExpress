{% extends "base.html" %}
{% block content %}
<div class="row mb-4" >
    {%for row in productos%}
    <div class="card mr-5 mt-4" style="width: 18rem;">
        <img class="card-img-top " style="height: 16rem;" src="https://images.photowall.com/products/54675/surfboard.jpg?h=699&q=85" alt="Card image cap">
        <div class="card-body"  >
          <h5 class="card-title">{{row.nombreProducto}}</h5>
          <p class="text-danger">!Solo quedan {{row.cantidad}}!</p>

          <div class="row container">
            <p class="card-text mr-2">{{row.marca}} </p>|
            <p class="ml-2">MXN ${{row.precio}}</p>
          </div>
          <div class="row ">
          <button class="btn text-white btn-warning ml-3 col-4" onclick="agregarCanasta('{{row.id}}','{{row.nombreProducto}}','{{row.cantidad}}','{{row.precio}}')" id="btnAdd"><i class="bi bi-cart-dash"></i> añadir</button>
        </div>
        </div>
      </div>
    {%endfor%}
    </div>
    <script>
$(document).ready(function(){
 });
 var cantidadAñadido=0;
 var carrito=[];
 var total=0;
 function agregarCanasta(id,nombreProducto,cantidad,precio){
  const popUpCarrito = document.getElementById("popUpCarrito");
var content = '';  
        var encontrado = carrito.some(function(producto) {return producto.id === id;});
if (!encontrado) {
  carrito.push({
    id:id,
    precio:parseInt(precio),
    nombreProducto:nombreProducto,
    cantidadAñadido:0,
    cantidadMaxima:cantidad
  })}
  let index = carrito.findIndex(producto => producto.id === id);
  // Verificar si se encontró el objeto en el array
  if (index !== -1) {
  if(carrito[index].cantidadAñadido<carrito[index].cantidadMaxima){
    carrito[index].cantidadAñadido=carrito[index].cantidadAñadido+1;  
cantidadAñadido++;
    $( "#txtPopupCantidad" ).empty();
        $( "#txtPopupCantidad" ).append( document.createTextNode( cantidadAñadido ));
  }
  }
  total+=carrito[index].precio;
$.each(carrito, function(index, value) {
  content +='<label for="total">'+carrito[index].nombreProducto+'</label>' 
  content +=  '<div class="row mt-2 mb-2"><button onclick="agregar('+carrito[index].id+')" class="btn btn-outline-warning ml-4">+</button>';
  content+='<div class="col-4 "><input type="text" value="'+carrito[index].cantidadAñadido+'" class=" text-center form-control" aria-label="Recipientusername with two button addons" aria-describedby="button-addon1" readonly></div>';
  content+='<button onclick="quitar('+carrito[index].id+')" class="btn btn-outline-warning ">-</button></div>';
});
content+='<label for="total">Total:</label>$<input type="text" class="subtotal"id="subtotal" readonly value=" '+total+' ""></div>'
content +=  '<div class="container"><button type="button" id="btnComprar" class="btn text-white btn-block mt-3" data-toggle="modal" data-target="#exampleModal" style="background-color: #4abaa5;">comprar</button></div>';
$(popUpCarrito).attr('data-content', content);
$(popUpCarrito).popover('show');    
  }
$(document).on('click','#btnComprar',function(){
     $(popUpCarrito).popover('hide');  
})

  $('#smartwizard').smartWizard({
                    selected: 0,
                    theme: 'dots',
                    autoAdjustHeight:true,
                    transitionEffect:'fade',
                    showStepURLhash: false,
                 
            });
function agregar(id){
  const popUpCarrito = document.getElementById("popUpCarrito");
var content = '';
let index = carrito.findIndex(producto => producto.id==id);
// Verificar si se encontró el objeto en el array
if (index !== -1) {
  if(carrito[index].cantidadAñadido<carrito[index].cantidadMaxima){
  carrito[index].cantidadAñadido=carrito[index].cantidadAñadido+1;
  cantidadAñadido++;
  $( "#txtPopupCantidad" ).empty();
  $( "#txtPopupCantidad" ).append( document.createTextNode( cantidadAñadido ));
}
 }
 total+=carrito[index].precio;
$.each(carrito, function(index, value) {

  content +='<label for="total">'+carrito[index].nombreProducto+'</label>' 
  content +=  '<div class="row mt-2 mb-2"><button onclick="agregar('+carrito[index].id+')" class="btn btn-outline-warning ml-4">+</button>';
  content+='<div class="col-4 "><input type="text" value="'+carrito[index].cantidadAñadido+'" class=" text-center form-control" aria-label="Recipientusername with two button addons" aria-describedby="button-addon1" readonly></div>';
  content+='<button onclick="quitar('+carrito[index].id+')" class="btn btn-outline-warning ">-</button></div>';
});
content+='<label for="total">Total:</label>$<input type="text" class="subtotal"id="subtotal" readonly value=" '+total+' ""></div>'
content +=  '<div class="container"><button type="button" id="btnComprar" class="btn text-white btn-block mt-3" data-toggle="modal" data-target="#exampleModal" style="background-color: #4abaa5;">comprar</button></div>';
$(popUpCarrito).attr('data-content', content);
$(popUpCarrito).popover('show');


}

function quitar(id){
  const popUpCarrito = document.getElementById("popUpCarrito");
  var content = '';
  let index = carrito.findIndex(producto => producto.id==id);
// Verificar si se encontró el objeto en el array
if (index !== -1) {
  if(carrito[index].cantidadAñadido>1){
    carrito[index].cantidadAñadido=carrito[index].cantidadAñadido-1;
    total-=carrito[index].precio;
  }else{
    total-=carrito[index].precio;
    carrito.splice(index, 1); 
  }

}
  if(cantidadAñadido>1){
    cantidadAñadido--;
 $( "#txtPopupCantidad" ).empty();
 $( "#txtPopupCantidad" ).append( document.createTextNode( cantidadAñadido ));
  }else{
    cantidadAñadido--;
   $( "#txtPopupCantidad" ).empty();
    content =  "<span class='text-white badge rounded-pill badge-notification bg-danger'>0</span> articulos añadidos";
  $("#btnComprar").remove();
  $(popUpCarrito).attr('data-content', content);
  $(popUpCarrito).popover('show');
  $(popUpCarrito).popover('refresh');
  }
$.each(carrito, function(index, value) {
  content +='<label for="total">'+carrito[index].nombreProducto+'</label>' 
 content +=  '<div class="row mt-2 mb-2"><button onclick="agregar('+carrito[index].id+')" class="btn btn-outline-warning ml-4">+</button>';
 content+='<div class="col-4 "><input type="text" value="'+carrito[index].cantidadAñadido+'" class=" text-center form-control" aria-label="Recipientusername with two button addons" aria-describedby="button-addon1" readonly></div>';
 content+='<button onclick="quitar('+carrito[index].id+')" class="btn btn-outline-warning ">-</button></div>';
});
content+='<label for="total">Total:</label>$<input type="text" class="subtotal"id="subtotal" readonly value=" '+total+' ""></div>'
content +=  '<div class="container"><button type="button" id="btnComprar" class="btn text-white btn-block mt-3" data-toggle="modal" data-target="#exampleModal" style="background-color: #4abaa5;">comprar</button></div>';
$(popUpCarrito).attr('data-content', content);
$(popUpCarrito).popover('show');


}
    </script>
{% endblock %}
